(()=>{"use strict";function e(e){return e=e.replace(/^https?:\/\/|www\.|\/.*/g,""),/^\w+\.v2ex.com/.test(e)&&(e=e.replace(/^\w+\.v2ex.com/,"v2ex.com")),e}function t(e){return"https://cors-anywhere.herokuapp.com/"+e}function c(e){403===e.status&&e.responseText.includes("/corsdemo")?($("#viewer iframe").attr("src",t("corsdemo")),n("Click 'Request temporary access to the demo server' button then try again.")):209===e.status&&e.responseText?n(e.responseText):n("Unkwon error. Reload page and try again.")}function n(e){$("#message").text(e).show()}var a=[{initialLinkText:"search this url in Google Cache",staticLinkText:"search this url in Google Cache",cachedLinkText:"search this url in Google Cache (cached)",notCachedLinkText:"search this url in Google Cache (no cache)",useIframe:!1,getSearchUrl:function(t){return t=t.replace(/^https?:\/\/|#.*/g,""),/^\w+\.v2ex.com/.test(t)&&(t=t.replace(/^\w+\.v2ex.com/,"v2ex.com")),/^v2ex.com/.test(t)&&(t=t.replace(/\?.*/,"")),`https://www.google.com/search?q=site%3A(${e(t)})%20inurl%3A("${encodeURIComponent(t)}")`},getCachedUrl:function(e){return e=e.replace(/^https?:\/\/|#.*$/g,""),/^\w+\.v2ex.com/.test(e)&&(e=e.replace(/^\w+\.v2ex.com/,"v2ex.com")),/^v2ex.com/.test(e)&&(e=e.replace(/\?.*/,"")),"https://webcache.googleusercontent.com/search?q=cache:"+e},getSnapshotUrl:function(e,n){jQuery.ajax({url:t(this.getSearchUrl(e)),dataType:"text",success:function(e){var t=$(e),c=$(t).find(".action-menu-item a").attr("href");console.log(c),n(c)},error:c,complete:function(){console.log("complete")}})}},{initialLinkText:"百度搜索快照",staticLinkText:"百度搜索快照 (加载中)",cachedLinkText:"百度搜索快照 (有快照)",notCachedLinkText:"百度搜索快照 (无快照)",useIframe:!0,getSearchUrl:function(t){return t=t.replace(/^https?:\/\/|#.*/g,""),/^\w+\.v2ex.com/.test(t)&&(t=t.replace(/^\w+\.v2ex.com/,"v2ex.com")),/^v2ex.com/.test(t)&&(t=t.replace(/\?.*/,"")),`https://www.baidu.com/s?wd=site%3A(${e(t)})%20inurl%3A("${encodeURIComponent(t)}")`},getCachedUrl:null,getSnapshotUrl:function(e,n){jQuery.ajax({url:t(this.getSearchUrl(e)),dataType:"text",success:function(e){var t=$(e),c=$(t).find("a.kuaizhao").attr("href");console.log(c),n(c)},error:c,complete:function(){console.log("complete")}})}},{initialLinkText:"search this url in Bing Cache",staticLinkText:"search this url in Bing Cache",cachedLinkText:"search this url in Bing Cache (cached)",notCachedLinkText:"search this url in Bing Cache (no cache)",useIframe:!0,getSearchUrl:function(t){return t=t.replace(/^https?:\/\/|#.*/g,""),/^\w+\.v2ex.com/.test(t)&&(t=t.replace(/^\w+\.v2ex.com/,"v2ex.com")),/^v2ex.com/.test(t)&&(t=t.replace(/\?.*/,"")),`https://www.bing.com/search?q=site%3A(${e(t)})%20("${encodeURIComponent(t)}")`},getCachedUrl:null,getSnapshotUrl:function(e,n){jQuery.ajax({url:t(this.getSearchUrl(e)),dataType:"text",success:function(e){var t=$(e),c=$(t).find(".b_attribution").attr("u");if(c){var a=c.split("|");if(a.length>=4){var r=`https://cc.bingj.com/cache.aspx?q=${encodeURIComponent(r)}&d=${a[2]}&mkt=en-US&setlang=en-US&w=${a[3]}`;return console.log(r),void n(r)}}n()},error:c,complete:function(){console.log("complete")}})}}];$((function(){$("form").on("submit",(function(){var e=$("form input").val();return location.hash==="#"+e?$(window).trigger("hashchange"):location.hash=e,!1})),$(window).on("hashchange",(function(){console.log("hashchange"),history.replaceState({},"","."+location.hash);var e=location.hash.replace(/^#/,"");if($("form input").val(e),$("#links ul li a").attr("href","javascript:;").attr("target","").each((function(e,t){var c=a[e];c&&$(t).text(c.initialLinkText)})),$("#viewer iframe").attr("src",""),$("#message").text("").hide(),e){if(!function(e){return/^((ftp|http|https):\/\/)?([^ \.\/"]+\.){1,}[^ \.\/"]{2,}(\/.*)?$/.test(e)}(e))return n("Invalid URL"),void $("form input")[0].focus();!function(e){$("#links ul li a").each((function(t,c){console.log(t);var n=a[t];n&&$(c).attr("href","function"==typeof n.getCachedUrl?n.getCachedUrl(e):"javascript:;").attr("target","function"==typeof n.getCachedUrl?"_blank":"").text(n.staticLinkText)}))}(e),function(e){a.forEach((function(t,c){t.getSnapshotUrl(e,(function(e){e?(t.useIframe&&($("#viewer iframe").attr("src")||$("#viewer iframe").attr("src",e)),$(`#links ul li:nth-child(${c+1}) a`).attr("href",e).attr("target",t.useIframe?"iframe-viewer":"_blank").text(t.cachedLinkText)):"function"!=typeof t.getCachedUrl&&$(`#links ul li:nth-child(${c+1}) a`).attr("href","javascript:;").attr("target","").text(t.notCachedLinkText)}))}))}(e)}})),$(window).trigger("hashchange")}))})();